<Window x:Class="TouchKeyboardMouse.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:TouchKeyboardMouse.Controls"
        Title="Touch Keyboard &amp; Mouse"
        WindowStyle="SingleBorderWindow"
        WindowState="Normal"
        AllowsTransparency="False"
        Topmost="True"
        Background="#1a1a1a"
        ShowInTaskbar="True"
        ResizeMode="CanResize"
        MinWidth="800"
        MinHeight="400"
        Loaded="Window_Loaded">
    
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        
        <!-- Always-visible vertical toolbar for window controls -->
        <Border Grid.Column="0" Background="#222" BorderBrush="#444" BorderThickness="0,0,1,0" CornerRadius="8,0,0,8" Margin="0,40,0,0" VerticalAlignment="Stretch" Effect="{DynamicResource DropShadowEffect}">
            <!-- Removed custom window control buttons; using native window chrome -->
        </Border>

        <!-- Main Content -->
        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <!-- Top bar with controls -->
                <RowDefinition Height="40"/>
                <!-- Keyboard area (3/5 of content) -->
                <RowDefinition Height="3*"/>
                <!-- Trackpad area (2/5 of content) -->
                <RowDefinition x:Name="TrackpadRow" Height="2*"/>
            </Grid.RowDefinitions>
            
            <!-- Top Control Bar -->
            <Border Grid.Row="0" Background="#0d0d0d" BorderBrush="#333" BorderThickness="0,0,0,1">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <!-- Draggable title area -->
                    <Border Grid.Column="0" Background="Transparent" MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="10,0">
                            <TextBlock Text="Touch Keyboard &amp; Mouse" Foreground="#888" FontSize="14" VerticalAlignment="Center"/>
                            <TextBlock x:Name="PostureStatusText" Text="" Foreground="#666" FontSize="12" VerticalAlignment="Center" Margin="15,0,0,0"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>
            <!-- Keyboard -->
            <local:VirtualKeyboard x:Name="Keyboard" Grid.Row="1" Margin="5"/>
            
            <!-- Trackpad with resize grips and optional numpad -->
            <Grid x:Name="TrackpadContainer" Grid.Row="2" Margin="5,0,5,5">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition x:Name="NumpadColumn" Width="0"/>
                </Grid.ColumnDefinitions>
                
                <!-- Trackpad Area with centered trackpad and attached grips -->
                <Grid x:Name="TrackpadArea" Grid.Column="0">
                    <!-- Centered container that holds trackpad and grips together -->
                    <Grid x:Name="TrackpadWithGrips" HorizontalAlignment="Center">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="12"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="12"/>
                        </Grid.ColumnDefinitions>
                        <!-- Left resize grip -->
                        <Border Grid.Column="0" x:Name="LeftResizeGrip" Background="Transparent" Cursor="SizeWE"
                                MouseDown="ResizeGrip_MouseDown" MouseMove="ResizeGrip_MouseMove" MouseUp="ResizeGrip_MouseUp">
                            <Border Width="4" Height="50" Background="#444" CornerRadius="2" VerticalAlignment="Center"
                                    HorizontalAlignment="Right"/>
                        </Border>
                        
                        <!-- Trackpad -->
                        <local:Trackpad x:Name="Trackpad" Grid.Column="1" MinWidth="300"/>
                        
                        <!-- Right resize grip -->
                        <Border Grid.Column="2" x:Name="RightResizeGrip" Background="Transparent" Cursor="SizeWE"
                                MouseDown="ResizeGrip_MouseDown" MouseMove="ResizeGrip_MouseMove" MouseUp="ResizeGrip_MouseUp">
                            <Border Width="4" Height="50" Background="#444" CornerRadius="2" VerticalAlignment="Center"
                                    HorizontalAlignment="Left"/>
                        </Border>
                    </Grid>
                </Grid>
                
                <!-- Numpad Panel - uses square buttons based on available height -->
                <Border x:Name="NumpadPanel" Grid.Column="1" Background="#1a1a1a" Margin="5,0,0,0" CornerRadius="8"
                        BorderBrush="#333" BorderThickness="1" Visibility="Collapsed"
                        SizeChanged="NumpadPanel_SizeChanged">
                    <Grid x:Name="NumpadGrid" Margin="5">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <!-- Row 1 -->
                        <Button Grid.Row="0" Grid.Column="0" Style="{StaticResource KeyButtonStyle}" Content="Num" Tag="NUMLOCK" Click="Numpad_Click"/>
                        <Button Grid.Row="0" Grid.Column="1" Style="{StaticResource KeyButtonStyle}" Content="/" Tag="DIVIDE" Click="Numpad_Click"/>
                        <Button Grid.Row="0" Grid.Column="2" Style="{StaticResource KeyButtonStyle}" Content="*" Tag="MULTIPLY" Click="Numpad_Click"/>
                        <Button Grid.Row="0" Grid.Column="3" Style="{StaticResource KeyButtonStyle}" Content="-" Tag="SUBTRACT" Click="Numpad_Click"/>
                        <!-- Row 2 -->
                        <Button Grid.Row="1" Grid.Column="0" Style="{StaticResource KeyButtonStyle}" Content="7" Tag="NUMPAD7" Click="Numpad_Click"/>
                        <Button Grid.Row="1" Grid.Column="1" Style="{StaticResource KeyButtonStyle}" Content="8" Tag="NUMPAD8" Click="Numpad_Click"/>
                        <Button Grid.Row="1" Grid.Column="2" Style="{StaticResource KeyButtonStyle}" Content="9" Tag="NUMPAD9" Click="Numpad_Click"/>
                        <Button Grid.Row="1" Grid.Column="3" Grid.RowSpan="2" Style="{StaticResource KeyButtonStyle}" Content="+" Tag="ADD" Click="Numpad_Click"/>
                        <!-- Row 3 -->
                        <Button Grid.Row="2" Grid.Column="0" Style="{StaticResource KeyButtonStyle}" Content="4" Tag="NUMPAD4" Click="Numpad_Click"/>
                        <Button Grid.Row="2" Grid.Column="1" Style="{StaticResource KeyButtonStyle}" Content="5" Tag="NUMPAD5" Click="Numpad_Click"/>
                        <Button Grid.Row="2" Grid.Column="2" Style="{StaticResource KeyButtonStyle}" Content="6" Tag="NUMPAD6" Click="Numpad_Click"/>
                        <!-- Row 4 -->
                        <Button Grid.Row="3" Grid.Column="0" Style="{StaticResource KeyButtonStyle}" Content="1" Tag="NUMPAD1" Click="Numpad_Click"/>
                        <Button Grid.Row="3" Grid.Column="1" Style="{StaticResource KeyButtonStyle}" Content="2" Tag="NUMPAD2" Click="Numpad_Click"/>
                        <Button Grid.Row="3" Grid.Column="2" Style="{StaticResource KeyButtonStyle}" Content="3" Tag="NUMPAD3" Click="Numpad_Click"/>
                        <Button Grid.Row="3" Grid.Column="3" Grid.RowSpan="2" Style="{StaticResource KeyButtonStyle}" Content="⏎" Tag="RETURN" Click="Numpad_Click"/>
                        <!-- Row 5 -->
                        <Button Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="2" Style="{StaticResource KeyButtonStyle}" Content="0" Tag="NUMPAD0" Click="Numpad_Click"/>
                        <Button Grid.Row="4" Grid.Column="2" Style="{StaticResource KeyButtonStyle}" Content="." Tag="DECIMAL" Click="Numpad_Click"/>
                    </Grid>
                </Border>
            </Grid>
        </Grid>
        
        <!-- Settings Sidebar -->
        <Border x:Name="SettingsSidebar" Grid.Column="1" Width="280" Background="#181818" 
                BorderBrush="#333" BorderThickness="1,0,0,0" Visibility="Collapsed">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="50"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- Sidebar Header -->
                <Border Grid.Row="0" Background="#1a1a1a" BorderBrush="#333" BorderThickness="0,0,0,1">
                    <Grid>
                        <TextBlock Text="Settings" Foreground="White" FontSize="16" FontWeight="SemiBold"
                                   VerticalAlignment="Center" Margin="15,0,0,0"/>
                        <Button HorizontalAlignment="Right" Style="{StaticResource ControlButtonStyle}"
                                Content="✕" Click="CloseSettings_Click" Margin="0,0,5,0"
                                WindowChrome.IsHitTestVisibleInChrome="True"/>
                    </Grid>
                </Border>
                
                <!-- Settings Content -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Margin="15,10,15,15">
                    <StackPanel>
                        <!-- Trackpad Section -->
                        <TextBlock Text="TRACKPAD" Foreground="#666" FontSize="11" FontWeight="SemiBold" Margin="0,0,0,10"/>
                        
                        <TextBlock Text="Drag the trackpad edges to resize" Foreground="#666" FontSize="11" 
                                   FontStyle="Italic" Margin="0,0,0,15"/>
                        
                        <TextBlock Text="Cursor Speed" Foreground="#ccc" FontSize="13" Margin="0,0,0,5"/>
                        <Grid Margin="0,0,0,15">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="45"/>
                            </Grid.ColumnDefinitions>
                            <Slider x:Name="CursorSensitivitySlider" 
                                    Minimum="0.5" Maximum="3" Value="1.5" 
                                    TickFrequency="0.1" IsSnapToTickEnabled="True"
                                    ValueChanged="CursorSensitivitySlider_ValueChanged"/>
                            <TextBlock x:Name="CursorSensitivityValue" Grid.Column="1" Text="1.5x" 
                                       Foreground="#888" VerticalAlignment="Center" HorizontalAlignment="Right"/>
                        </Grid>
                        
                        <TextBlock Text="Scroll Speed" Foreground="#ccc" FontSize="13" Margin="0,0,0,5"/>
                        <Grid Margin="0,0,0,15">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="45"/>
                            </Grid.ColumnDefinitions>
                            <Slider x:Name="ScrollSensitivitySlider" 
                                    Minimum="0.5" Maximum="5" Value="2.0" 
                                    TickFrequency="0.1" IsSnapToTickEnabled="True"
                                    ValueChanged="ScrollSensitivitySlider_ValueChanged"/>
                            <TextBlock x:Name="ScrollSensitivityValue" Grid.Column="1" Text="2.0x" 
                                       Foreground="#888" VerticalAlignment="Center" HorizontalAlignment="Right"/>
                        </Grid>
                        
                        <TextBlock Text="Tap Sensitivity" Foreground="#ccc" FontSize="13" Margin="0,0,0,5"/>
                        <Grid Margin="0,0,0,20">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="45"/>
                            </Grid.ColumnDefinitions>
                            <Slider x:Name="TapThresholdSlider" 
                                    Minimum="100" Maximum="500" Value="200" 
                                    TickFrequency="25" IsSnapToTickEnabled="True"
                                    ValueChanged="TapThresholdSlider_ValueChanged"/>
                            <TextBlock x:Name="TapThresholdValue" Grid.Column="1" Text="200ms" 
                                       Foreground="#888" VerticalAlignment="Center" HorizontalAlignment="Right"/>
                        </Grid>
                        
                        <!-- Window Section -->
                        <Border Height="1" Background="#333" Margin="0,0,0,15"/>
                        <TextBlock Text="WINDOW" Foreground="#666" FontSize="11" FontWeight="SemiBold" Margin="0,0,0,10"/>
                        
                        <CheckBox x:Name="AlwaysOnTopCheckBox" Content="Always on top" 
                                  Foreground="#ccc" IsChecked="True" Margin="0,5"
                                  Checked="AlwaysOnTopCheckBox_Changed" Unchecked="AlwaysOnTopCheckBox_Changed"/>
                        
                        <!-- Reset Button -->
                        <Border Height="1" Background="#333" Margin="0,20,0,15"/>
                        <Button Content="Reset to Defaults" Style="{StaticResource ControlButtonStyle}"
                                Height="32" Click="ResetDefaults_Click" HorizontalAlignment="Stretch"
                                WindowChrome.IsHitTestVisibleInChrome="True"/>
                        
                        <!-- About -->
                        <Border Height="1" Background="#333" Margin="0,20,0,15"/>
                        <TextBlock Text="ABOUT" Foreground="#666" FontSize="11" FontWeight="SemiBold" Margin="0,0,0,10"/>
                        <TextBlock Text="Touch Keyboard &amp; Mouse v1.0" Foreground="#ccc" FontSize="12"/>
                        <TextBlock Text="Virtual input for dual-screen devices" Foreground="#666" FontSize="11" Margin="0,3,0,0"/>
                    </StackPanel>
                </ScrollViewer>
            </Grid>
        </Border>
    </Grid>
</Window>
